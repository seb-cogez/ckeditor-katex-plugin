CKEDITOR.dialog.add("katex",(function(editor){var preview,lang=editor.lang.katex,shadow,eltId=editor.id;return{title:lang.title,minWidth:350,minHeight:100,contents:[{id:"mathEq",elements:[{id:"equation",type:"textarea",label:lang.dialogInput,onLoad:function(){var that=this;CKEDITOR.env.ie&&8==CKEDITOR.env.version||this.getInputElement().on("keyup",(function(){var tex=that.getInputElement().getValue().trim();katex.render(tex,preview,{throwOnError:!1,errorColor:"#FFF"})}))},setup:function(widget){if(""!==widget.data.formula){var tex=widget.data.formula.trim();this.setValue(tex),katex.render(tex,preview,{throwOnError:!1,errorColor:"#FFF"})}else preview.setText("");if("x = \\dfrac{-b \\pm \\sqrt{b^2-4ac}}{2a}"===this.getInputElement().getValue()){var that=document.getElementById(this.getInputElement().$.id);that.focus(),that.select()}},commit:function(widget){widget.setData("formula",this.getValue().trim())}},{id:"documentation",type:"html",html:'<div style="width:100%;text-align:right;margin:-8px 0 10px"><a class="cke_mathjax_doc" href="'+lang.docUrl+'" target="_blank" style="cursor:pointer;color:#00B2CE;text-decoration:underline">'+lang.docLabel+"</a></div>"},{id:"preview",type:"html",html:'<div id="'+eltId+'_shdwRt"></div>',onLoad:function(){var host=document.getElementById(eltId+"_shdwRt"),katexPreview=document.createElement("div");katexPreview.setAttribute("id","katexPreview");var lnk=document.createElement("link");lnk.setAttribute("rel","stylesheet"),lnk.setAttribute("href","js/katex/katex.min.css"),lnk.setAttribute("type","text/css");var style=document.createElement("style");style.textContent="\n                        #katexPreview {\n                            display:inline-block;\n                            font-size:1.6em;\n                        }\n                        ",(shadow=host.attachShadow({mode:"open"})).appendChild(lnk),shadow.appendChild(style),shadow.appendChild(katexPreview),preview=shadow.getElementById("katexPreview")}}]}]}}));